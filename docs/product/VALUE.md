# プロダクトの価値定義と目標

## 背景 / 課題

複数拠点を運営する組織（例: クリニック、チェーン店舗、代理店）では、Google Business Profile (GBP) の情報更新が分散・属人的になりがちです。これにより以下の問題が発生します。

- 不整合: 営業時間/電話/URL/説明が拠点ごとにばらつく
- リード損失: 最新の正確情報が出ないことで機会損失
- 監査困難: だれが・いつ・何を変更したか追えない
- セキュリティ: OAuth/トークンの取り扱いが散在し、漏えいリスクが高い

## 対象ユーザー / ステークホルダー

- 事業責任者: ブランド一貫性・運用コスト削減・リスク低減
- オペレーター: 作業の簡素化、承認待ちの見える化、エラーの自己解決
- 情シス/セキュリティ: 権限/RLS・暗号化・監査ログを前提とした安全運用
- 代理店/パートナー: 複数テナントの安全な並行運用

## 価値命題（Value Proposition）

1) 一貫した変更管理: 変更申請→承認→同期→監査を一気通貫で管理し、差分/反映を可視化

2) 安全な連携基盤: OAuthとトークン管理を分離。暗号化保存（secureテーブル）＋RLSでデータ境界を強制

3) 自動化と信頼性: ジョブ（pg-boss）で反映・再試行・レート制御。期限切れトークンの自動更新

4) 代理店運用代行に最適化: 複数テナント/組織を跨ぐ権限と監査、オーナー向けポータル、社内レビュー/承認（ダブルチェック）と法令遵守チェックを前提に設計

## 最小有効フロー（MVP 縦切り）

- ユーザがGoogleで認可 → ダッシュボードにサインイン状態・トークン残存時間を表示
- ロケーション一覧/詳細（読み取り）
- 変更申請フォーム（限定項目）→ 承認 → GBP APIへ反映 → 結果/監査を参照

## 成功指標（KPI）

- 初回価値確認までの日数（目安: ≤ 10日）
- 変更反映時間の中央値（目安: ≤ 数分）
- 変更失敗率（HTTP 4xx/5xx）と自動再試行成功率
- 業務手順の短縮（手入力/手戻りの削減）
- 監査ログの網羅性（申請/承認/反映が全件追跡可能）

## 非ゴール（現フェーズ）

- GBP全APIの完全対応
- 高度な多言語/多ブランドUI
- 複数クラウド/DB可搬の抽象化（まずはSupabase前提）

## リスクと緩和

- OAuthテストモードの制約: リフレッシュトークン短命 → 定期更新ジョブ＋失効時の再認可UX
- RLSポリシーの複雑さ: 段階導入（Service Role→RLS段階適用）＋検証用スクリプト
- レート制限/クォータ: 単純レート制御→トークンバケット/集中制御に移行計画
- 本番セキュリティ: Cookie Secure/SameSite設定、環境変数/鍵管理の運用策をドキュメント化

## 参照

- マイルストーン: `docs/product/MILESTONES.md`
- 運用ガイド: `AGENTS.md`
- セットアップ: `README.md`, `docs/gcp-oauth-setup.md`

---

## 利用シーン（追加）

このプラットフォームは、Google ビジネス プロフィール（GBP）活用が十分でない顧客に対し、当社がMEO/GBP運用を代行する前提で設計します。

- ビジネスオーナー（クリニック等）
  - 目的: 集客・集患。適切な営業情報・アピール要素の提示と誘導最大化
  - 必要機能: 誘導数/反応のレポート（月次/期間比較）、変更依頼フォーム、支払い/プラン設定
  - 期待UI: オーナーポータル（ダッシュボード・依頼履歴・請求関連）

- 代理店（当社）
  - 目的: 顧客の変更依頼を受け付け、ガイドラインに沿ってレビュー/承認し、GBPへ反映
  - 必要機能: 変更申請キュー、レビュアー/承認者のダブルチェック、医療法等の法令遵守チェック（人/AI併用）、監査ログ、SLA/通知
  - 期待UI: 承認キュー、差分ビュー、コンプライアンスチェックリスト、失敗/再試行の可視化

- レポーティング（オーナー向け）
  - 指標例: 検索表示数、ウェブサイトクリック、ルート・電話アクション、予約リンクCTR、投稿反応
  - データ源: GBP Insights API（将来拡張: GA4/GSC等）
  - 提供形態: ダッシュボード/CSVエクスポート/定期メール

- 支払い/契約
  - 目的: プラン/請求/支払い管理（外部決済連携を前提）
  - フェーズ: 本MVP外。マイルストーンで段階導入

詳細なストーリーや状態遷移は `docs/product/USE_CASES.md` および `docs/product/WORKFLOWS.md` を参照してください。
